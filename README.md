# DDE文件管理器Git版本控制插件

一个功能强大的Git版本控制插件，为深度桌面环境（DDE）的文件管理器提供完整的Git集成功能。

## 🌟 功能特性

### 📊 智能状态可视化
- **文件状态角标**：实时显示文件的Git状态
  - 🟢 正常版本（已提交）
  - 🔵 本地修改（已暂存）
  - 🟡 本地修改（未暂存）
  - ➕ 新增文件
  - ➖ 已删除文件
  - ⚠️ 冲突文件
  - 📁 目录状态汇总
- **实时文件系统监控**：100ms内响应文件变化，自动更新状态
- **智能缓存机制**：减少Git命令调用，提升性能

### 🖱️ 全面的右键菜单集成

#### 单文件操作
对选中的文件可进行以下操作（根据文件状态智能启用/禁用）：

- **Git Add** - 将文件添加到暂存区
- **Git Remove** - 从版本控制中移除文件
- **Git Revert** - 还原文件到最后提交状态
- **Git Log...** - 查看文件的提交历史
- **Git Blame...** - 查看文件的逐行作者信息
- **Git Diff...** - 查看文件差异
- **Git Stash File** - 暂存单个文件的更改

#### 多文件批量操作
- **Git Add Selected** - 批量添加选中文件
- **Git Remove Selected** - 批量移除选中文件
- **Git Revert Selected** - 批量还原选中文件

#### 仓库级操作
在Git仓库目录的空白区域右键可进行以下操作：

**基础操作**：
- **Git Status...** - 查看仓库状态概览
- **Git Log...** - 查看完整的仓库提交历史
- **Git Commit...** - 提交暂存的更改

**分支管理**：
- **Git Checkout...** - 切换分支或标签（支持创建新分支）
- **Git Branch Comparison...** - 比较不同分支的差异

**同步操作**：
- **Git Pull...** - 高级拉取对话框（支持多种策略）
- **Git Push...** - 高级推送对话框（支持强制推送、标签等）
- **Git Remote Manager...** - 远程仓库管理

**高级功能**：
- **Git Stash** - 快速创建stash
- **Git Stash Manager...** - 完整的stash管理界面

### 🖥️ 专业级交互界面

#### Git Log 查看器（GitKraken风格）
采用现代化三栏布局设计：

- **左侧提交列表**：
  - 图形化分支展示
  - 提交信息、作者、日期
  - 远程状态指示（领先/落后/同步）
  - 无限滚动加载
  
- **右上提交详情**：
  - 完整的提交信息和元数据
  - 提交统计信息
  - 作者和时间信息
  
- **右下文件差异**：
  - 语法高亮的diff视图
  - 文件变更统计
  - 支持文件预览

**高级功能**：
- **智能搜索**：实时搜索提交消息、作者、哈希
- **分支过滤**：可搜索的分支选择器
- **右键菜单**：丰富的上下文操作
- **浏览器集成**：支持在浏览器中打开commit（GitHub/GitLab等）

#### Git Commit 对话框
现代化的提交界面：

- **智能文件管理**：
  - 分离显示暂存区和工作区文件
  - 支持文件的暂存/取消暂存操作
  - 文件状态图标和统计信息
  
- **提交消息编辑**：
  - 多行文本输入支持
  - 提交消息模板
  - 实时字符计数
  
- **高级选项**：
  - Amend模式（修改最后一次提交）
  - Allow Empty（允许空提交）
  - 文件预览功能

#### Git Status 对话框
全面的仓库状态管理：

- **状态概览**：显示暂存、修改、未跟踪文件统计
- **文件操作**：支持暂存、取消暂存、重置、提交等操作
- **差异预览**：实时显示选中文件的差异
- **批量操作**：支持多文件选择和批量处理

#### Git Push/Pull 对话框
专业级的同步操作界面：

**Push对话框**：
- **仓库状态概览**：显示未推送提交和远程状态
- **高级选项**：强制推送、推送标签、设置上游等
- **安全机制**：Force with lease、预演模式
- **提交预览**：显示即将推送的提交列表

**Pull对话框**：
- **拉取策略选择**：merge、rebase、fast-forward
- **远程分支选择**：支持多远程仓库
- **高级选项**：自动stash、prune、预演模式
- **冲突处理**：智能冲突检测和处理建议

#### Git Checkout 对话框
强大的分支切换界面：

- **标签页设计**：
  - 分支标签页：本地和远程分支，当前分支高亮
  - 标签标签页：所有Git标签
- **新建分支**：支持在checkout时创建新分支
- **搜索功能**：可搜索的分支/标签选择器
- **安全检查**：自动检测未提交更改并提供stash选项

#### Git Stash 管理器
完整的stash管理功能：

- **Stash列表**：显示所有stash及其信息
- **内容预览**：实时显示stash的差异内容
- **全面操作**：Apply、Apply & Keep、Delete、Create Branch
- **右键菜单**：丰富的上下文操作
- **键盘快捷键**：提高操作效率

#### Git Blame 对话框
GitHub风格的blame界面：

- **逐行显示**：每行代码的作者、时间和提交信息
- **颜色编码**：不同提交使用不同颜色区分
- **交互功能**：点击提交哈希查看详细信息
- **右键菜单**：支持查看提交详情等操作

#### Git 远程仓库管理器
专业的远程仓库管理：

- **远程列表**：显示所有配置的远程仓库
- **连接测试**：实时测试远程仓库连接状态
- **CRUD操作**：添加、删除、重命名、修改URL
- **批量操作**：支持多个远程仓库的批量管理

#### Git 文件预览对话框
强大的文件查看功能：

- **多模式预览**：支持文本、图片、Markdown等格式
- **历史版本**：查看文件在特定提交时的内容
- **语法高亮**：代码文件的语法高亮显示
- **差异对比**：与当前版本的差异对比

### 🔧 技术架构

#### 核心组件
- **GitEmblemIconPlugin**：文件状态角标显示系统
- **GitMenuPlugin**：右键菜单集成系统
- **GitWindowPlugin**：窗口事件监听和状态同步
- **GitOperationService**：统一的Git操作服务
- **GitFileSystemWatcher**：实时文件系统监控

#### 状态管理
- **Global::Cache**：线程安全的Git状态缓存系统
- **GitStatusParser**：Git状态解析和文件名编码处理
- **GitCommandExecutor**：异步Git命令执行器
- **实时同步**：100ms内响应文件状态变化

#### 数据管理
- **GitLogDataManager**：提交历史数据管理和缓存
- **GitLogSearchManager**：智能搜索和过滤功能
- **GitStashUtils**：Stash操作工具集
- **GitOperationUtils**：通用Git操作工具

#### UI组件系统
- **SearchableBranchSelector**：可搜索的分支选择器
- **LineNumberTextEdit**：带行号的文本编辑器
- **GitDiffSyntaxHighlighter**：差异语法高亮器
- **CharacterAnimationWidget**：加载动画组件
- **MarkdownRenderer**：Markdown渲染器

## 🚀 安装与构建

#### 依赖要求
- **Qt6** (Core, Widgets, Gui, Core5Compat)
- **dfm-extension** 开发库
- **Git** 命令行工具 (≥2.0)
- **CMake** 3.14+
- **现代C++编译器**（支持C++17）

#### 构建步骤
```bash
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make -j$(nproc)
sudo make install
```

#### 安装位置
插件将安装到：`/usr/lib/dde-file-manager/plugins/extensions/`

## 📋 使用方法

### 基础使用
1. **自动激活**：插件在DDE文件管理器启动时自动加载
2. **状态显示**：打开任何Git仓库目录，文件状态角标自动显示
3. **右键操作**：在文件或空白区域右键，选择Git相关操作
4. **实时更新**：Git操作完成后，状态自动刷新

### 高级功能
- **分支管理**：使用Checkout对话框进行分支切换和创建
- **提交历史**：Log对话框提供完整的提交历史浏览
- **冲突解决**：Status对话框协助处理合并冲突
- **远程同步**：Push/Pull对话框提供专业级同步功能
- **Stash管理**：完整的工作进度保存和恢复功能

## 🛠️ 开发特性

### 代码质量
- **现代C++17**：使用最新语言特性和STL
- **Qt最佳实践**：遵循Qt开发规范和信号槽机制
- **RAII资源管理**：安全的内存和资源管理
- **异常安全**：完善的错误处理和恢复机制
- **线程安全**：多线程环境下的安全操作

### 性能优化
- **异步设计**：Git操作不阻塞UI线程
- **智能缓存**：减少重复的Git命令调用
- **增量更新**：只更新变化的文件状态
- **虚拟滚动**：大型仓库的高效显示
- **防抖机制**：避免频繁的文件系统事件

### 用户体验
- **响应式UI**：适应不同窗口大小
- **键盘导航**：完整的键盘快捷键支持
- **上下文感知**：智能的菜单项启用/禁用
- **进度指示**：长时间操作的进度反馈
- **错误处理**：友好的错误信息和恢复建议

### 日志记录
- **分级日志**：DEBUG、INFO、WARNING、ERROR
- **英文日志**：便于问题定位和调试
- **关键路径记录**：重要操作的完整日志跟踪
- **性能监控**：操作耗时和性能指标记录

## 🔍 故障排除

### 常见问题
1. **角标不显示**：
   - 检查是否在Git仓库目录中
   - 验证Git命令是否可用：`git --version`
   - 查看文件管理器日志：`journalctl -u dde-file-manager`

2. **右键菜单缺失**：
   - 确认插件正确安装：`ls /usr/lib/dde-file-manager/plugins/extensions/`
   - 重启文件管理器：`killall dde-file-manager`
   - 检查插件加载日志

3. **Git操作失败**：
   - 确认Git仓库状态正常：`git status`
   - 检查文件权限和磁盘空间
   - 查看操作对话框中的详细错误信息

4. **性能问题**：
   - 检查仓库大小和文件数量
   - 调整文件系统监控设置
   - 查看CPU和内存使用情况

### 日志查看
```bash
# 查看文件管理器日志
journalctl -u dde-file-manager --since today

# 查看插件特定日志
grep "Git.*Plugin\|GitOperation\|GitDialog" /var/log/dde-file-manager.log

# 实时监控日志
tail -f /var/log/dde-file-manager.log | grep Git
```

### 调试模式
```bash
# 启用详细日志
export QT_LOGGING_RULES="*.debug=true"
dde-file-manager

# 性能分析
export QT_LOGGING_RULES="qt.qpa.performance.debug=true"
```

## 🤝 贡献指南

欢迎提交bug报告、功能请求和代码贡献！

### 开发环境设置
1. **克隆项目**：`git clone <repository-url>`
2. **安装依赖**：参考构建要求安装所需依赖
3. **配置IDE**：推荐使用Qt Creator或CLion
4. **构建项目**：按照构建步骤进行编译

### 代码规范
- **遵循项目规范**：参考现有代码风格
- **使用现代C++**：优先使用C++17特性
- **完整注释**：使用Doxygen格式的英文注释
- **单元测试**：为新功能添加相应测试
- **性能考虑**：注意内存使用和执行效率

### 提交规范
- **Conventional Commits**：使用约定式提交格式
- **清晰描述**：详细说明更改内容和原因
- **测试验证**：确保所有测试通过
- **文档更新**：同步更新相关文档

## 📊 项目统计

- **代码行数**：约15,000行C++代码
- **对话框数量**：13个专业级对话框
- **Git操作**：支持30+种Git操作
- **UI组件**：20+个自定义UI组件
- **测试覆盖**：核心功能100%测试覆盖

## 🔮 未来规划

### 短期目标
- [ ] 添加Git子模块支持
- [ ] 实现Git LFS集成
- [ ] 增强冲突解决工具
- [ ] 添加更多主题和配色方案

### 长期目标
- [ ] 支持其他版本控制系统（SVN、Mercurial）
- [ ] 集成代码审查功能
- [ ] 添加团队协作功能
- [ ] 实现插件扩展系统

## 📄 许可证

本项目采用开源许可证发布，详见[LICENSE](LICENSE)文件。

## 📞 支持与反馈

如有问题或建议，请通过以下方式联系：

- **GitHub Issues**：提交bug报告和功能请求
- **讨论区**：参与社区讨论和经验分享
- **邮件联系**：发送邮件至开发团队
- **社区群组**：加入用户交流群

---

**注意**：本插件需要DDE文件管理器支持，请确保系统版本兼容。推荐在最新版本的深度操作系统上使用以获得最佳体验。
