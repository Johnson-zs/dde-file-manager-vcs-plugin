# DDE文件管理器Git版本控制插件

一个功能强大的Git版本控制插件，为深度桌面环境（DDE）的文件管理器提供完整的Git集成功能。

## 功能特性

### 📊 可视化状态指示
- **文件状态角标**：直观显示文件的Git状态
  - 🟢 正常版本（已提交）
  - 🔵 本地修改（已暂存）
  - 🟡 本地修改（未暂存）
  - ➕ 新增文件
  - ➖ 已删除文件
  - ⚠️ 冲突文件
  - 📁 目录状态汇总

### 🖱️ 右键菜单集成

#### 单文件操作
对选中的文件可进行以下操作（根据文件状态智能启用/禁用）：

- **Git Add** - 将文件添加到暂存区
  - 适用于：未版本控制、本地修改（未暂存）的文件
- **Git Remove** - 从版本控制中移除文件
  - 适用于：已版本控制的文件
- **Git Revert** - 还原文件到最后提交状态
  - 适用于：有本地修改或冲突的文件
- **Git Log...** - 查看文件的提交历史
  - 适用于：已在版本控制中的文件

#### 空白区域操作
在Git仓库目录的空白区域右键可进行以下操作：

- **Git Log...** - 查看完整的仓库提交历史
- **Git Checkout...** - 切换分支或标签
- **Git Pull...** - 拉取远程更新
- **Git Push...** - 推送本地提交
- **Git Commit...** - 提交暂存的更改

### 🖥️ 丰富的交互界面

#### Git Log 查看器
参考GitKraken的设计，提供强大的提交历史查看功能：

- **三栏布局**：
  - 左侧：提交列表（图形化分支展示、提交信息、作者、日期）
  - 右上：提交详情（完整的提交信息和元数据）
  - 右下：文件差异（语法高亮的diff视图）

- **高级功能**：
  - 分支切换和过滤
  - 提交搜索功能
  - 实时刷新
  - 支持文件级别和仓库级别的日志查看

#### Git Checkout 对话框
- **标签页设计**：
  - 分支标签页：显示本地和远程分支，当前分支高亮
  - 标签标签页：显示所有Git标签
- **新建分支**：支持在checkout时创建新分支
- **双击快速切换**：提高操作效率

#### Git 操作进度对话框
- **实时输出**：显示Git命令的实时执行结果
- **进度指示**：不确定进度的进度条动画
- **错误处理**：清晰的错误信息显示和状态指示

#### Git Commit 对话框
- **提交信息编辑**：多行文本输入，支持详细的提交描述
- **文件选择**：可选择性提交特定文件
- **暂存区状态**：显示当前暂存区的文件

## 🔧 技术架构

### 核心组件
- **GitEmblemIconPlugin**：负责文件状态角标显示
- **GitMenuPlugin**：负责右键菜单功能
- **GitWindowPlugin**：负责窗口事件监听和状态更新
- **GitDialogs**：各种Git操作的图形界面

### 状态管理
- **Global::Cache**：线程安全的Git状态缓存系统
- **GitVersionController**：后台Git状态监控和更新
- **实时同步**：文件状态变化的实时反映

### Git集成
- **命令行调用**：通过QProcess调用Git命令
- **状态解析**：解析`git status --porcelain`输出
- **仓库检测**：自动检测Git仓库边界

## 🚀 安装与构建

### 依赖要求
- Qt6 (Core, Widgets, Gui, Core5Compat)
- dfm-extension 开发库
- Git 命令行工具
- CMake 3.14+
- 现代C++编译器（支持C++17）

### 构建步骤
```bash
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make -j$(nproc)
sudo make install
```

### 安装位置
插件将安装到：`/usr/lib/dde-file-manager/plugins/extensions/`

## 📋 使用方法

1. **自动激活**：插件在DDE文件管理器启动时自动加载
2. **状态显示**：打开任何Git仓库目录，文件状态角标自动显示
3. **右键操作**：在文件或空白区域右键，选择Git相关操作
4. **实时更新**：Git操作完成后，状态自动刷新

## 🛠️ 开发特性

### 代码质量
- **现代C++17**：使用最新语言特性
- **Qt最佳实践**：遵循Qt开发规范
- **RAII资源管理**：安全的内存和资源管理
- **异常安全**：完善的错误处理机制

### 性能优化
- **多线程设计**：Git操作不阻塞UI线程
- **智能缓存**：减少重复的Git命令调用
- **增量更新**：只更新变化的文件状态
- **内存优化**：合理的对象生命周期管理

### 日志记录
- **分级日志**：DEBUG、INFO、WARNING、ERROR
- **英文日志**：便于问题定位和调试
- **关键路径记录**：重要操作的完整日志跟踪

## 🔍 故障排除

### 常见问题
1. **角标不显示**：
   - 检查是否在Git仓库目录中
   - 验证Git命令是否可用
   - 查看dde-file-manager日志

2. **右键菜单缺失**：
   - 确认插件正确安装
   - 重启文件管理器
   - 检查插件加载日志

3. **Git操作失败**：
   - 确认Git仓库状态正常
   - 检查文件权限
   - 查看操作对话框中的错误信息

### 日志查看
```bash
# 查看文件管理器日志
journalctl -u dde-file-manager --since today

# 查看插件特定日志
grep "GitMenuPlugin\|GitWindowPlugin\|GitEmblemIconPlugin" /var/log/dde-file-manager.log
```

## 🤝 贡献指南

欢迎提交bug报告、功能请求和代码贡献！

### 开发环境设置
1. 克隆项目：`git clone <repository-url>`
2. 安装开发依赖
3. 配置IDE（推荐Qt Creator）
4. 遵循代码规范进行开发

### 代码规范
- 遵循Qt编码风格
- 使用现代C++特性
- 添加适当的注释和文档
- 包含单元测试

## 📄 许可证

本项目采用开源许可证发布，详见LICENSE文件。

## 📞 支持

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至开发团队
- 参与社区讨论

---

**注意**：本插件需要DDE文件管理器支持，确保系统版本兼容。
